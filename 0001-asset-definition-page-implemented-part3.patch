From b7fcc17ae9e464420576c8c63e55ea4400cebab2 Mon Sep 17 00:00:00 2001
From: sonaligupta <sonaligupta847@gmail.com>
Date: Thu, 21 Nov 2013 14:45:11 +0530
Subject: [PATCH 1/2] asset definition page implemented part3

---
 .../controllers/StateModelController.groovy        |   21 ++++++++++
 llamrei/grails-app/i18n/messages.properties        |    1 +
 llamrei/grails-app/views/stateModel/_addStates.gsp |   41 --------------------
 llamrei/grails-app/views/stateModel/_addstate.gsp  |   37 ------------------
 .../views/stateModel/_stateRulesForm.gsp           |    9 +++--
 llamrei/grails-app/views/stateModel/_states.gsp    |   25 ++++++++----
 .../grails-app/views/stateModel/_statesForm.gsp    |    1 +
 llamrei/grails-app/views/stateModel/edit.gsp       |   15 ++++++-
 llamrei/web-app/css/main.css                       |   16 ++++----
 9 files changed, 67 insertions(+), 99 deletions(-)
 delete mode 100644 llamrei/grails-app/views/stateModel/_addStates.gsp
 delete mode 100644 llamrei/grails-app/views/stateModel/_addstate.gsp

diff --git a/llamrei/grails-app/controllers/com/llamrei/controllers/StateModelController.groovy b/llamrei/grails-app/controllers/com/llamrei/controllers/StateModelController.groovy
index a8456c6..6873802 100644
--- a/llamrei/grails-app/controllers/com/llamrei/controllers/StateModelController.groovy
+++ b/llamrei/grails-app/controllers/com/llamrei/controllers/StateModelController.groovy
@@ -217,4 +217,25 @@ class StateModelController {
         states.add(state)
         render template: 'states', model: [states:states, stateModelId:stateModel.id]
     }
+
+
+    def deleteState={
+        println "params in deleteState : "+params
+        Integer stateId = Integer.parseInt(params.stateId)
+        State state = State.get(stateId)
+        state.delete()
+        println "state deleted :)"
+        render true
+    }
+
+
+    def deleteStateRule={
+        println "params in deleteStateRule : "+params
+        Integer stateRuleId = Integer.parseInt(params.stateRuleId)
+        StateRule stateRule = StateRule.get(stateRuleId)
+        stateRule.delete()
+        println "stateRule deleted :)"
+        render true
+    }
 }
+
diff --git a/llamrei/grails-app/i18n/messages.properties b/llamrei/grails-app/i18n/messages.properties
index 133bc3d..767c2f7 100644
--- a/llamrei/grails-app/i18n/messages.properties
+++ b/llamrei/grails-app/i18n/messages.properties
@@ -72,6 +72,7 @@ title.state.name=Name
 title.state.description=Description
 title.state.stateRules=State Rule
 button.add.state=Add State
+button.add.state.delete=Delete State
 button.add.state.rule=Add State Rule
 title.stateRule.ruleType=Rule Type
 title.stateRule.ruleValue=Rule Value
diff --git a/llamrei/grails-app/views/stateModel/_addStates.gsp b/llamrei/grails-app/views/stateModel/_addStates.gsp
deleted file mode 100644
index bbd5a89..0000000
--- a/llamrei/grails-app/views/stateModel/_addStates.gsp
+++ /dev/null
@@ -1,41 +0,0 @@
-<script type="text/javascript">
-
-
-        function addstate(){
-            alert("you are about to define a new state")
-            $('#addstate_clone').clone().insertAfter("#addstate_clone");
-        }
-
-
-    //bind click event on delete buttons using jquery live
-    $('.del-state').live('click', function() {
-
-        //find the parent div
-        var prnt = $(this).parents(".state-div");
-        //find the deleted hidden input
-        var delInput = prnt.find("input[id$=deleted]");
-        //check if this is still not persisted
-        var newValue = prnt.find("input[id$=new]").attr('value');
-        //if it is new then i can safely remove from dom
-        if(newValue == 'true'){
-            prnt.remove();
-        }else{
-            //set the deletedFlag to true
-            delInput.attr('value','true');
-            //hide the div
-            prnt.hide();
-        }
-    });
-
-</script>
-
-<div id="childList">
-    <g:each var="state" in="${stateModelInstance}" status="i">
-
-        <!-- Render the addstate template (_addstate.gsp) here -->
-        <g:render template='addstate' model="['addstate':addstate,'i':i,'hidden':false]"/>
-        <!-- Render the addstate template (_addstate.gsp) here -->
-
-    </g:each>
-</div>
-<input type="button" id="button1" value="Add state"  onclick=addstate() />
diff --git a/llamrei/grails-app/views/stateModel/_addstate.gsp b/llamrei/grails-app/views/stateModel/_addstate.gsp
deleted file mode 100644
index 95339db..0000000
--- a/llamrei/grails-app/views/stateModel/_addstate.gsp
+++ /dev/null
@@ -1,37 +0,0 @@
-<div id="addstate_clone" class="state-div" <g:if test="${hidden}">style="display:none;"</g:if>>
-
-
-    <g:hiddenField name='statesList[${i}].id' value='${addstate?.id}'/>
-    <g:hiddenField name='statesList[${i}].deleted' value='false'/>
-    <g:hiddenField name='statesList[${i}].new' value="${addstate?.id == null?'true':'false'}"/>
-
-
-
-    <span class="del-state">
-        <img src="${resource(dir:'images/skin', file:'icon_delete.png')}"
-             style="vertical-align:middle;"/>
-    </span>
-    <table>
-    <tbody>
-    <tr class="prop">
-        <td valign="top" class="name">
-            <label for="name"><g:message code="stateModel.name.label" default="Name"/></label>
-        </td>
-        <td valign="top" class="value ${hasErrors(bean: addstate, field: 'name', 'errors')}">
-            <g:textField name="name" value="${addstate?.name}"/>
-        </td>
-    </tr>
-    <tr class="prop">
-        <td valign="top" class="name">
-            <label for="description"><g:message code="stateModel.name.label" default="description"/></label>
-        </td>
-        <td valign="top" class="value ${hasErrors(bean: addstate, field: 'name', 'errors')}">
-            <g:textField name="name" value="${addstate?.description}"/>
-        </td>
-    </tr>
-    </tbody>
-</table>
-
-
-
-</div>
diff --git a/llamrei/grails-app/views/stateModel/_stateRulesForm.gsp b/llamrei/grails-app/views/stateModel/_stateRulesForm.gsp
index 43cc53e..f7835e6 100644
--- a/llamrei/grails-app/views/stateModel/_stateRulesForm.gsp
+++ b/llamrei/grails-app/views/stateModel/_stateRulesForm.gsp
@@ -13,7 +13,7 @@
     </div>
     <div>
         <label class="lb"><g:message code="title.stateRule.ruleType"/></label>
-        <g:textField class="field" id="state.stateRule.ruleType" name="state.stateRule.ruleType" value="" style="margin-left: 5%;"/>
+        <g:select id="state.stateRule.ruleType" name="state.stateRule.ruleType" from="${['>', '<', '=']}" />
     </div>
     <div>
         <label class="lb"><g:message code="title.stateRule.ruleValue"/></label>
@@ -23,6 +23,7 @@
 
 <div>
     <a onclick="addStateRule()" class="actionButton">
-        <span><g:message code="button.add"/></span>
-    </a>
-</div>
\ No newline at end of file
+    <span><g:message code="button.add"/></span>
+</a>
+</div>
+
diff --git a/llamrei/grails-app/views/stateModel/_states.gsp b/llamrei/grails-app/views/stateModel/_states.gsp
index 051c1d1..bc2c5b6 100644
--- a/llamrei/grails-app/views/stateModel/_states.gsp
+++ b/llamrei/grails-app/views/stateModel/_states.gsp
@@ -1,16 +1,19 @@
-<div class="table-box">
+<div id="table-box1" class="table-box">
     <table cellspacing="0" cellpadding="0">
         <thead>
         <tr class="ui-widget-header">
         <th width="150px"><g:message code="title.state.name"/></th>
         <th width="150px"><g:message code="title.state.description"/></th>
         <th width="150px"><g:message code="title.state.stateRules"/></th>
+        <th></th>
         </thead>
         <tbody>
+        <th>
         <g:each in="${states}" var="state">
-            <tr>
+                <tr id="state-${state.id}">
                 <td>${state.name}</td>
                 <td>${state.description}</td>
+
                 <td>
                         <g:each in="${state.stateRules}" var="stateRule">
                              <ul>
@@ -21,17 +24,23 @@
                              </ul>
                         </g:each>
                 </td>
-            </</td>
+                             <td>
+                                  <a onclick="deleteState('${state.id}')"class="actionButton" style="display:inline">
+                                      <span><g:message code="button.add.state.delete"/>
+                                        </span>
+                                      </a>
+                                </td>
+
             </tr>
         </g:each>
-        <tr>
-            <td colspan="3">
-                <a onclick="showStateForm()" class="actionButton">
+       <div>
+                <a onclick="showStateForm()" class="actionButton" style="display:inline">
                     <span><g:message code="button.add.state"/></span>
                 </a>
-            </td>
-        </tr>
+          </div>
+        </th>
         </tbody>
+
     </table>
 </div>
 
diff --git a/llamrei/grails-app/views/stateModel/_statesForm.gsp b/llamrei/grails-app/views/stateModel/_statesForm.gsp
index f931266..4fe7b51 100644
--- a/llamrei/grails-app/views/stateModel/_statesForm.gsp
+++ b/llamrei/grails-app/views/stateModel/_statesForm.gsp
@@ -29,4 +29,5 @@
     <a onclick="addState()" class="actionButton">
         <span><g:message code="button.add"/></span>
     </a>
+
 </div>
\ No newline at end of file
diff --git a/llamrei/grails-app/views/stateModel/edit.gsp b/llamrei/grails-app/views/stateModel/edit.gsp
index 963b449..77e5503 100644
--- a/llamrei/grails-app/views/stateModel/edit.gsp
+++ b/llamrei/grails-app/views/stateModel/edit.gsp
@@ -146,13 +146,26 @@
         });
     }
 
+
+    function deleteState(id){
+        alert("You are about to delete a state");
+         $.ajax({
+               type: 'POST',
+               url: '${createLink(controller: 'stateModel', action: 'deleteState')}',
+               data: {stateId:id},
+               success: function(data) {
+
+                  $('tr#state-'+id).remove();
+               }
+         });
+    }
     var srIndex = 0;
     function showStateRulesForm(){
         $('#stateRuleForm').toggle();
     }
     function addStateRule(){
         var timeSeries = $('select[name="state.stateRule.timeSeries"]').val();
-        var ruleType = $('input[name="state.stateRule.ruleType"]').val();
+        var ruleType = $('select[name="state.stateRule.ruleType"]').val();
         var ruleValue = $('input[name="state.stateRule.ruleValue"]').val();
 
         $('#stateRulesTable tbody').prepend('<tr class="stateRule">' +
diff --git a/llamrei/web-app/css/main.css b/llamrei/web-app/css/main.css
index b989ee4..61d998f 100644
--- a/llamrei/web-app/css/main.css
+++ b/llamrei/web-app/css/main.css
@@ -287,14 +287,14 @@ td.errors textarea {
     text-transform: uppercase;
 }
 
-.box-cards-title a.btn-open {
-    display: block;
-    width: 100%;
-    color: #383838;
-    font-size: 14px;
-    line-height: 30px;
-    font-weight: bold;
-}
+/*.box-cards-title a.btn-open {*/
+    /*display: block;*/
+    /*width: 100%;*/
+    /*color: #383838;*/
+    /*font-size: 14px;*/
+    /*line-height: 30px;*/
+    /*font-weight: bold;*/
+/*}*/
 
 .box-cards-title a.btn-open span {
     padding-left: 32px;
-- 
1.7.10.msysgit.1

